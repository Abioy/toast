__TOC__
= Web端向Controller端发送消息方式 =
Web端通过向约定目录创建协议文件、Controller端主动轮循获取的方式与Controller端通信。
== 运行任务 ==
```javascript
{
    "RunID":"11", // 运行任务主键
    "Commands":
    [{
        "CommandID":"19", // 运行命令主键
        "TestBox":"ip", // ip地址
        "TestCommand":"ping www.taobao.com -c10", // 命令
        "Timeout":"1440", // 超时值
        "Sudoer":"root" // 执行帐号
    }],
    "TestType":"Regress" // [Unit|Regress]
}
```
== 取消任务 ==
```javascript
{
    "RunID":"11", // 运行任务主键
    "Commands":
     [{
         "CommandID":"19", // 运行命令主键
         "TestBox":"test", // 忽略
         "TestCommand":"test", // 忽略
         "Timeout":"1440", // 忽略
         "Sudoer":"root" // 忽略
    }],
    "TestType":"CancelRun" // 取消操作
}
```
== 设定定时 ==
```javascript
{
    "TestType":"TimerTask", // 定时任务操作
    "RunID":"0", // 忽略
    "Commands":
    [{
        "TestCommand":"Del", // 删除定时任务操作
        "AppendInfo":"{"TaskID":"1","Time":"3 0 * * *"}"
    },{
        "TestCommand":"Add", // 添加定时任务操作
        "AppendInfo":"{"TaskID":"1","Time":"3 0 * * *"}"
    }]
}
```
== 设置SVN监控 ==
```javascript
{
    "TestType":"CI", // 监控SVN任务操作
    "RunID":"0", // 忽略
    "Commands":
    [{
        "TestCommand":"Update", // 添加监控SVN任务操作
        "AppendInfo":"{"TaskID":"1","SVN":"http:\/\/xxx"}"
    }]
}
```
= Controller端向Web端发送消息方式 =
Controller端通过调用API方式与Web端通信。以下列出的API将会被废弃，逐步过渡到[https://github.com/taobao/toast/wiki/API API]
== 更新任务运行结果 ==
*地址：http://{yourtoast}/run/updaterun
*支持HTTP方法：GET&POST
*是否需要验证：否
*参数
{| style="margin-left: 20px; width: 950px" class="wikitable" border="1" cellpadding="1" cellspacing="1"
|-
!style="text-align:left"|名称
!类型
!style="width:150px"|是否必需
!style="text-align:left"|示例值
!style="text-align:left"|描述
|-
|id
|style="text-align:center"|integer
|style="text-align:center"|是
|9527
|运行命令ID
|-
|status
|style="text-align:center"|integer
|style="text-align:center"|是
|200
|运行状态
|-
|return_value
|style="text-align:center"|integer
|style="text-align:center"|否
|0
|命令返回值
|-
|desc_info
|style="text-align:center"|string
|style="text-align:center"|否
|something
|描述信息
|}
*返回数据
```javascript
{
    "status":"success" // [success|failed]
}
```
== 更新测试机 ==
*地址：http://{yourtoast}/machine/updatemachine
*支持HTTP方法：GET&POST
*是否需要验证：否
*参数
{| style="margin-left: 20px; width: 950px" class="wikitable" border="1" cellpadding="1" cellspacing="1"
|-
!style="text-align:left"|名称
!类型
!style="width:150px"|是否必需
!style="text-align:left"|示例值
!style="text-align:left"|描述
|-
|hostname
|style="text-align:center"|string
|style="text-align:center"|是
|v132194.machine
|机器名
|-
|status
|style="text-align:center"|integer
|style="text-align:center"|是
|0 idle; 1 running; 2 down
|机器状态
|-
|version
|style="text-align:center"|string
|style="text-align:center"|否
|1.0.2
|Agent版本号
|-
|type
|style="text-align:center"|integer
|style="text-align:center"|是
|0 linux; 1 windows
|OS类型
|-
|ip
|style="text-align:center"|string
|style="text-align:center"|是
|192.168.1.100
|机器IP地址
|-
|os
|style="text-align:center"|string
|style="text-align:center"|否
|centos 5.4
|操作系统信息
|-
|cpu
|style="text-align:center"|integer
|style="text-align:center"|否
|4
|CPU核数
|}
*返回数据
```javascript
{
    "code":0, // 0 成功；1 失败
    "msg":"success",
    "machine":
    {
        "ip": "10.232.134.98",
        "id": "16",
        "name": "v132194.machin"，
        ...
    } // 成功时返回machine属性信息， 失败时返回null
}
```