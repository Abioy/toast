__TOC__ 
== API调用介绍 ==
Toast API采用HTTP调用方式，遵守REST协议，中间数据格式采用JSON。
== API认证方式 ==
Toast API采用token验证方式。
=== 获取token ===
* 登录Toast，点击右上方当前登录用户名，进入用户设置页面。点击生成身份验证密钥（即token）。
<img src="http://rossblog-wordpress.stor.sinaapp.com/uploads/2013/01/token.png" />
=== token的有效期 ===
目前token生成一次永久有效。再次生成，上一次的token失效。
=== token的验证使用方式 ===
调用API时，通过GET方法传递token参数。<br/>
例如：
<pre>
http://{yourtoast}/user/get/id/10?token=7ad1781f0cd770ab9e8099f6a0abb9dc
</pre>
== API返回格式 ==
Toast API 采用 JSON 作为返回值格式。其中 status 和 msg 为常量，“success”代表 API 运行结果成功状态，“failure”代表 API 运行结果失败状态。
```javascript
{
    "status":"success", // success|failure
    "msg":"Create test case success, #1 just created.", // message
    "xxx": "xxx" // other fields
    ...
}
```
== 任务API ==
=== 运行任务 ===
*地址：http://{yourtoast}/task/run
*支持HTTP方法：GET&POST
*是否需要验证：是
*参数
{| style="margin-left: 20px; width: 950px" class="wikitable" border="1" cellpadding="1" cellspacing="1"
|-
!style="text-align:left"|名称
!类型
!style="width:150px"|是否必需
!style="text-align:left"|示例值
!style="text-align:left"|描述
|-
|id
|style="text-align:center"|integer
|style="text-align:center"|是(id 或 build 其一必填)
|9527
|任务ID
|-
|build
|style="text-align:center"|string
|style="text-align:center"|是(id 或 build 其一必填)
|<pre>[{
    "svn_url": "http://{svnurl}",
    "svn_version": "81121",
    "package":"{package}",
    "package_name":"{package_name}",
    "package_branch": "test",
    "rpm_url":"http://{rpm_url}"
}]
</pre>
|任务关联Build
|-
|dev_log
|style="text-align:center"|string
|style="text-align:center"|否
|<pre>[{
    "author":"xxx",
    "date": "xxxx",
    "comment": "xxxx",
    "revisionbegin": "xxxx",
    "revisionend": "xxxxxx",
    "lists": 
    [{
        "file": "xxxx",
        "action": "M", #[M|A|D]
        "diffurl": "http://xxxx", 
    }]
}]
</pre>
|代码提交信息
|-
|mail_to
|style="text-align:center"|string
|style="text-align:center"|否
|toast-norpley@taobao.com, toast, Toast
|邮件通知给信息，多个收件人之间以“,”分割
|-
|param
|style="text-align:center"|string
|style="text-align:center"|否
| -c 10
|任务运行参数，替换命令中的$BUILD
|}
*返回数据
```javascript
{
    "status": "success", // success|failure
    "msg": "Task #2 run, task run #9527 just created.",
    "runids": [9527] // TaskRun id, it is null if failed
}
```
*FAQ
** 如果同时填写 id 和 build，build将会被忽略。
** build 可能会触发多个任务运行，故返回值 runids 是数组。
** build 触发后该build包名将替换命令中的Build参数
** 当同时有新build包参数和param参数时，build包参数为第一参数，param参数为第二参数。

== 报表API ==
== 用例API ==
*FAQ
== 机器API ==